var map;require(["esri/map","dojo/request","esri/geometry/Circle","esri/symbols/SimpleFillSymbol","esri/graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/SpatialReference","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/FeatureLayer","dojo/domReady!"],function(e,t,a,r,s,i){function o(e){var t={geometry:{x:e.geometry.x,y:e.geometry.y,spatialReference:{wkid:102100}},attributes:{title:e.attributes.title,datasets:e.attributes.datasets_count},symbol:{color:[237,108,33,128],size:Math.min(Math.round(e.attributes.datasets_count/100*20),50),angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:1,type:"esriSLS",style:"esriSLSSolid"}}},a=new s(t);n.add(a)}function l(e){var t=e.graphic.attributes.datasets,a=e.graphic.attributes.title;$("#title").html(a),$("#count").html("Datasets: "+t)}esriConfig.defaults.map.basemaps.dotted={baseMapLayers:[{url:"http://studio.esri.com/arcgis/rest/services/World/WorldBasemapBlack/MapServer"}],title:"dots"},map=new e("map",{center:[-56.049,38.485],zoom:3,basemap:"dotted"});var n=new i({id:"circles"});map.addLayer(n),n.on("mouse-over",function(e){l(e)}),t("explore.json").then(function(e){var t,a=JSON.parse(e).sites;a.forEach(function(e){t={geometry:{x:e.default_extent.xmin+(e.default_extent.xmax-e.default_extent.xmin)/2,y:e.default_extent.ymin+(e.default_extent.ymax-e.default_extent.ymin)/2,type:"point",spatialReference:{latestWkid:3857,wkid:102100}},attributes:{title:e.title,url:e.url,created_at:e.created_at,updated_at:e.updated_at,"public":e.public,groups_count:e.groups_count,datasets_count:e.datasets_count}},o(t)})})});
var map;require(["esri/map","dojo/request","esri/geometry/Circle","esri/symbols/SimpleFillSymbol","esri/graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/FeatureLayer","dojo/domReady!"],function(a,o,e,t,c,s,i,n,r){function d(a){var o={geometry:{x:a.geometry.x,y:a.geometry.y,spatialReference:{wkid:102100}},attributes:{title:a.attributes.title,datasets:a.attributes.datasets_count,url:a.attributes.url,groups:a.attributes.groups_count},symbol:{color:[237,50,133,128],size:Math.min(Math.round(a.attributes.datasets_count/100*40),50),angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[171,23,89,200],width:1,type:"esriSLS",style:"esriSLSSolid"}}},e=new c(o);g.add(e)}function p(a){var o=a.graphic.attributes.datasets,e=a.graphic.attributes.title,t=a.graphic.attributes.groups;$("#title").html(e),$("#groups").html("Open Data Groups: "+t),$("#count").html("Datasets: "+o)}function m(a){""!==a.graphic.attributes.url&&null!==a.graphic.attributes.url&&window.open(a.graphic.attributes.url)}esriConfig.defaults.map.basemaps.dotted={baseMapLayers:[{url:"http://studio.esri.com/arcgis/rest/services/World/WorldBasemapBlack/MapServer"}],title:"dots"},map=new a("map",{center:[-56.049,38.485],zoom:3,basemap:"dotted"});var g=new s({id:"circles"});map.addLayer(g),g.on("mouse-over",function(a){p(a)}),g.on("click",function(a){m(a)}),g.on("mouse-out",function(){});var l=["gisdata.evvc.opendata.arcgis.com","public.colletoncounty.opendata.arcgis.com","vicroadsopendata.vicroadsmaps.opendata.arcgis.com","aampo.mpo.opendata.arcgis.com","bostonopendata.boston.opendata.arcgis.com","waterschap.bovendams.opendata.arcgis.com","bramptonopendata.brampton.opendata.arcgis.com","spatial.cml.opendata.arcgis.com","gis.ecan.opendata.arcgis.com","cityofcommercecityopendata.c3.opendata.arcgis.com","data.dublinohio.opendata.arcgis.com","maps.fallschurch.opendata.arcgis.com","mapss.gahanna.opendata.arcgis.com","cohgis.mycity.opendata.arcgis.com","cityofpasadenaca.pasgis.opendata.arcgis.com","gis.dedham.opendata.arcgis.com","maps.gahanna.opendata.arcgis.com","halifaxopendatacatalogue.hrm.opendata.arcgis.com","honolulu.cchnl.opendata.arcgis.com","lcc.launceston.opendata.arcgis.com","longmontopendata.longmontco.opendata.arcgis.com","data.nftwp.opendata.arcgis.com","geoportaal.ddh.opendata.arcgis.com","lavienne.cg86.opendata.arcgis.com","lapilot.caro.opendata.arcgis.com","opensalem.salem.opendata.arcgis.com","sig.bmo.opendata.arcgis.com","gisdata.cosmo.opendata.arcgis.com","beta.dcgis.opendata.arcgis.com","data.brookline.opendata.arcgis.com","data.grotongis.opendata.arcgis.com","town.mooresvillenc.opendata.arcgis.com","wakeopen.wake.opendata.arcgis.com","eprinkrez.vrk.opendata.arcgis.com","banen.banedanmark.opendata.arcgis.com","maps.acpa.opendata.arcgis.com","gisdata.arlgis.opendata.arcgis.com","data.carver.opendata.arcgis.com","ccbcc.collierbcc.opendata.arcgis.com","countyassessordatasharingsite.assessoroffice.opendata.arcgis.com","data.countyofriverside.opendata.arcgis.com","data.dogis.opendata.arcgis.com","fultoncountygadataportal.fulcogis.opendata.arcgis.com","data.galwaycoco.opendata.arcgis.com","hcgistn.hamcogis.opendata.arcgis.com","parcels.lunacountynm.opendata.arcgis.com","gis.madisonva.opendata.arcgis.com","mauicountydataportal.malama.opendata.arcgis.com","montereycountyopendata.montereyco.opendata.arcgis.com","roscommon.roscoco.opendata.arcgis.com","gis.sbcountydpw.opendata.arcgis.com","odb.sarpy.opendata.arcgis.com","sonomacountyopendata.sonomamap.opendata.arcgis.com","openstlco.stlcogis.opendata.arcgis.com","gis.wardnd.opendata.arcgis.com","maps.waukeshacounty.opendata.arcgis.com","gis.woodwi.opendata.arcgis.com","gis.nci.opendata.arcgis.com","test.onf.opendata.arcgis.com","usfs.usda-fs.opendata.arcgis.com","andes.ccrp.opendata.arcgis.com","opendhn.dhnetwork.opendata.arcgis.com","fsp.bmgf.opendata.arcgis.com","globalforestwatch.gfw.opendata.arcgis.com","onswater.bovendams.opendata.arcgis.com","ohdr.nethope.opendata.arcgis.com","d3.d3.opendata.arcgis.com","vts.bmgf.opendata.arcgis.com","demo.gobiernoregional.opendata.arcgis.com","incogsopendatasite.incog.opendata.arcgis.com","www.cavgp.opendata.arcgis.com","gis.ramathanadiv.opendata.arcgis.com","opendatasigsa.sigsapue.opendata.arcgis.com","data.gaiaose.opendata.arcgis.com","gis.cccommission.opendata.arcgis.com","dataportal.mtc.opendata.arcgis.com","ssmmaopendata.ssmma-gis.opendata.arcgis.com","arc.garc.opendata.arcgis.com","alabama.pluton.opendata.arcgis.com","beta.cdphgis.opendata.arcgis.com","data.myfwc.opendata.arcgis.com","geohubpathfinder.uwyo.opendata.arcgis.com","data.idwr.opendata.arcgis.com","illinoisepaopendata.illinois-epa.opendata.arcgis.com","indianamap.esristl.opendata.arcgis.com","kygovmaps.kygeonet.opendata.arcgis.com","opendata.somdits.opendata.arcgis.com","njogis.newjersey.opendata.arcgis.com","public.hhsproto.opendata.arcgis.com","tn.tnmap.opendata.arcgis.com","imap.maryland.opendata.arcgis.com","udot.uplan.opendata.arcgis.com","gismaps.vgin.opendata.arcgis.com","washingtonopendata.wa-geoservices.opendata.arcgis.com","gdl.wadshs.opendata.arcgis.com","wyowildlife.wsfd.opendata.arcgis.com","campuslab.tims.opendata.arcgis.com","geoportal.congeo.opendata.arcgis.com","meurio.pcrj.opendata.arcgis.com","geoinfo.idsgobiernolocal.opendata.arcgis.com"];o("http://opendata.arcgis.com/explore.json").then(function(a){var o,e=JSON.parse(a).sites;e.forEach(function(a){var e=a.url.replace(/http:\/\//,"");if(-1!==l.indexOf(e)){var t,c=a.default_extent.xmin+(a.default_extent.xmax-a.default_extent.xmin)/2,s=a.default_extent.ymin+(a.default_extent.ymax-a.default_extent.ymin)/2;if(a.default_extent.spatialReference)if(4326===a.default_extent.spatialReference.wkid){var i=r.lngLatToXY(c,s);t={x:i[0],y:i[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else t={x:c,y:s,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};else if(4326===a.default_extent.spatial_reference.wkid){var i=r.lngLatToXY(c,s);t={x:i[0],y:i[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else t={x:c,y:s,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};o={geometry:t,attributes:{title:a.title,url:a.url,created_at:a.created_at,updated_at:a.updated_at,"public":a.public,groups_count:a.groups_count,datasets_count:a.datasets_count}},d(o)}})})});
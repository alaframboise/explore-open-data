var map;require(["esri/map","dojo/request","esri/geometry/Circle","esri/symbols/SimpleFillSymbol","esri/graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/SpatialReference","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/FeatureLayer","dojo/domReady!"],function(t,e,a,r,i,s){function o(t){var e={geometry:{x:t.geometry.x,y:t.geometry.y,spatialReference:{wkid:102100}},attributes:{title:t.attributes.title,datasets:t.attributes.datasets_count,url:t.attributes.url,groups:t.attributes.groups_count},symbol:{color:[237,50,133,128],size:Math.min(Math.round(t.attributes.datasets_count/100*40),50),angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:0,type:"esriSLS",style:"esriSLSSolid"}}},a=new i(e);l.add(a)}function u(t){var e=t.graphic.attributes.datasets,a=t.graphic.attributes.title,r=t.graphic.attributes.groups;$("#title").html(a),$("#groups").html("Open Data Groups: "+r),$("#count").html("Datasets: "+e)}function n(t){""!==t.graphic.attributes.url&&null!==t.graphic.attributes.url&&window.open(t.graphic.attributes.url)}esriConfig.defaults.map.basemaps.dotted={baseMapLayers:[{url:"http://studio.esri.com/arcgis/rest/services/World/WorldBasemapBlack/MapServer"}],title:"dots"},map=new t("map",{center:[-56.049,38.485],zoom:3,basemap:"dotted"});var l=new s({id:"circles"});map.addLayer(l),l.on("mouse-over",function(t){u(t)}),l.on("click",function(t){n(t)}),l.on("mouse-out",function(){}),e("explore.json").then(function(t){var e,a=JSON.parse(t).sites;a.forEach(function(t){e={geometry:{x:t.default_extent.xmin+(t.default_extent.xmax-t.default_extent.xmin)/2,y:t.default_extent.ymin+(t.default_extent.ymax-t.default_extent.ymin)/2,type:"point",spatialReference:{latestWkid:3857,wkid:102100}},attributes:{title:t.title,url:t.url,created_at:t.created_at,updated_at:t.updated_at,"public":t.public,groups_count:t.groups_count,datasets_count:t.datasets_count}},o(e)})})});